<div class="incidents-container">
  <div class="header-section">
    <h2 class="title">Lista de Incidentes</h2>
  </div>

  <div class="filters-card">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Búsqueda libre</label>
        <input type="text" [(ngModel)]="criteria.searchTerm" placeholder="Buscar..." class="filter-input">
      </div>
      <div class="filter-group">
        <label>Estado</label>
        <select [(ngModel)]="criteria.status" class="filter-input">
          <option value="">Todos</option>
          <option *ngFor="let status of statusMap | keyvalue" [value]="status.key">{{ status.value }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Nivel</label>
        <select [(ngModel)]="criteria.level" class="filter-input">
          <option value="">Todos</option>
          <option *ngFor="let level of levelMap | keyvalue" [value]="level.key">{{ level.value }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ID Responsable</label>
        <input type="number" [(ngModel)]="criteria.responsibleId" class="filter-input">
      </div>
      <div class="filter-group">
        <label>ID Área</label>
        <input type="number" [(ngModel)]="criteria.areaId" class="filter-input">
      </div>
      <div class="filter-group">
        <label>Fecha Inicio</label>
        <input type="date" [(ngModel)]="criteria.startDate" class="filter-input">
      </div>
      <div class="filter-group">
        <label>Fecha Fin</label>
        <input type="date" [(ngModel)]="criteria.endDate" class="filter-input">
      </div>
    </div>
    <div class="filter-actions">
      <button (click)="applyFilters()" class="btn-primary">Filtrar</button>
      <button (click)="resetFilters()" class="btn-secondary">Restablecer</button>
    </div>
  </div>

  <div class="table-card">
    <div class="table-responsive">
      <table class="custom-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Título</th>
            <th>Descripción</th>
            <th>Tipo</th>
            <th (click)="changeSort('level')" class="clickable">
              Nivel
              <span class="sort-icon" *ngIf="criteria.sortBy === 'level'">
                {{ criteria.sortOrder === 'asc' ? '▲' : '▼' }}
              </span>
            </th>
            <th>Estado</th>
            <th>ID Responsable</th>
            <th>ID Área</th>
            <th (click)="changeSort('createdAt')" class="clickable">
              Fecha
              <span class="sort-icon" *ngIf="criteria.sortBy === 'createdAt'">
                {{ criteria.sortOrder === 'asc' ? '▲' : '▼' }}
              </span>
            </th>
            <th class="actions-header">ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let incident of incidents">
            <td>#{{ incident.id }}</td>
            <td><strong>{{ incident.title }}</strong></td>
            <td>{{ incident.description }}</td>
            <td>{{ incident.type }}</td>
            <td>
              <span class="badge" [ngClass]="getLevelClass(incident.level)">
                {{ translateLevel(incident.level) }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="getStatusClass(incident.status)">
                {{ translateStatus(incident.status) }}
              </span>
            </td>
            <td>{{ incident.responsibleId }}</td>
            <td>{{ incident.areaId }}</td>
            <td>{{ incident.createdAt | date:'short' }}</td>
            <td class="actions-cell">
              <button class="btn-action btn-edit" (click)="editIncident(incident)" title="Editar">
                <i class="icon-edit">Editar</i>
              </button>
              <button class="btn-action btn-delete" (click)="deleteIncident(incident.id)" title="Cerrar">
                <i class="icon-delete">Eliminar</i>
              </button>
              <button class="btn-action btn-history" (click)="viewHistory(incident.id)" title="Historial">
                <i class="icon-history">Historial</i>
              </button>
              <button class="btn-action btn-attachment" (click)="viewAttachments(incident.id)" title="Adjuntos">
                <i class="icon-attachment">adjuntos</i>
              </button>
            </td>
          </tr>
          <tr *ngIf="incidents.length === 0">
            <td colspan="10" class="text-center empty-state">No se encontraron incidentes.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <button (click)="changePage(criteria.page! - 1)" [disabled]="criteria.page === 0" class="btn-page">Anterior</button>
      <span>Página {{ criteria.page! + 1 }}</span>
      <button (click)="changePage(criteria.page! + 1)" [disabled]="incidents.length < (criteria.size || 10)" class="btn-page">Siguiente</button>
    </div>
  </div>

  <button (click)="openCreateModal()" class="btn-primary">Crear Incidente</button>

  <div class="modal-overlay" *ngIf="showModal" (click)="closeCreateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <app-create-incident [incident]="selectedIncident" (onClose)="closeCreateModal()"></app-create-incident>
    </div>
  </div>
</div>
